<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Axiom IoT - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f4f4f4; }
        .status-new { background-color: #ffebee; }
        .status-contact { background-color: #e8f5e9; }
    </style>
</head>
<body>
    <h1><i class="fas fa-chart-line"></i> Axiom IoT - Customer Inquiries</h1>
    
    <div id="loading">Loading inquiries...</div>
    <div id="inquiryCount" style="margin: 20px 0;"></div>
    
    <table id="inquiriesTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Name</th>
                <th>Mobile</th>
                <th>Email</th>
                <th>Project Type</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="inquiriesBody"></tbody>
    </table>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    
    <script>
        // Use same Firebase config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Load inquiries
        db.collection("inquiries")
            .orderBy("timestamp", "desc")
            .onSnapshot((snapshot) => {
                const inquiriesBody = document.getElementById('inquiriesBody');
                const loading = document.getElementById('loading');
                const inquiryCount = document.getElementById('inquiryCount');
                
                loading.style.display = 'none';
                inquiriesBody.innerHTML = '';
                
                let count = 0;
                
                snapshot.forEach((doc) => {
                    count++;
                    const data = doc.data();
                    const date = data.timestamp ? 
                        new Date(data.timestamp.toDate()).toLocaleDateString() : 'N/A';
                    
                    const row = `
                        <tr class="status-${data.status || 'new'}">
                            <td>${date}</td>
                            <td>${data.name}</td>
                            <td><a href="tel:${data.mobile}">${data.mobile}</a></td>
                            <td><a href="mailto:${data.email}">${data.email}</a></td>
                            <td>${data.projectType}</td>
                            <td>${data.status || 'new'}</td>
                            <td>
                                <button onclick="viewDetails('${doc.id}')">View</button>
                                <button onclick="updateStatus('${doc.id}', 'contacted')">Mark Contacted</button>
                            </td>
                        </tr>
                    `;
                    inquiriesBody.innerHTML += row;
                });
                
                inquiryCount.innerHTML = `<strong>Total Inquiries: ${count}</strong>`;
            });
        
        function viewDetails(docId) {
            db.collection("inquiries").doc(docId).get().then((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    alert(`Details for ${data.name}:\n
Mobile: ${data.mobile}\n
Email: ${data.email}\n
Address: ${data.address}\n
Project: ${data.projectType}\n
Details: ${data.projectDetails}`);
                }
            });
        }
        
        function updateStatus(docId, status) {
            db.collection("inquiries").doc(docId).update({
                status: status
            }).then(() => {
                alert('Status updated!');
            });
        }
    </script>
</body>
</html>